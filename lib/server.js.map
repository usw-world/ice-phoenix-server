{"version":3,"file":"server.js","names":["app","express","require","CheckUser","AddUser","GetData","UpdateData","PORT_NUMBER","use","urlencoded","extended","post","req","res","CreateUser","body","userKey","gameData","statusCode","json","result","message","JSON","parse","dataJson","tryCount","crypto","randomBytes","toString","setHeader","console","log","listen"],"sources":["../src/server.js"],"sourcesContent":["import express from \"express\";\r\nimport crypto from \"crypto\";\r\nconst app = express();\r\n\r\nconst { CheckUser, AddUser, GetData, UpdateData } = require(\"./dynamodb\");\r\n\r\nconst PORT_NUMBER = 2022;\r\n\r\napp.use(express.urlencoded({ extended: true }));\r\napp.post('/create-user', async (req, res) => {\r\n    CreateUser(res);\r\n});\r\napp.post('/get-data', async (req, res) => {\r\n    const gameData = await GetData(req.body.userKey);\r\n    if(!gameData) {\r\n        res.statusCode = 500;\r\n        res.json({\r\n            result: 500,\r\n            userKey: req.body.userKey,\r\n            message: \"유저 데이터를 찾을 수 없습니다.\\n개발자에게 문의 바랍니다.\"\r\n        })\r\n    } else {\r\n        res.json(gameData);\r\n    }\r\n});\r\napp.post('/sync-data', async (req, res) => {\r\n    const gameData = {\r\n        ...JSON.parse(req.body.dataJson)\r\n    };\r\n    if(await UpdateData(gameData)) {\r\n        res.json({\r\n            result : 200\r\n        });\r\n    } else {\r\n        res.json({\r\n            result : 500\r\n        });\r\n    }\r\n});\r\n\r\nasync function CreateUser(res) {\r\n    let userKey;\r\n    let tryCount = 0;\r\n    do {\r\n        tryCount ++;\r\n        userKey = crypto.randomBytes(64).toString('base64');\r\n    } while(!await CheckUser(userKey) || tryCount >= 10);\r\n    res.setHeader(\"Content-Type\", \"application/json\");\r\n    if(await AddUser(userKey)) {\r\n        res.json({\r\n            result : 200,\r\n            userKey : userKey\r\n        });\r\n    } else {\r\n        console.log(\"Faild to put new user key. So return error-message to client.\");\r\n        res.json({\r\n            result : 500,\r\n            message : \"서버에서 예외가 발생하였습니다.\\n서버 담당자에게 문의해주시길 바랍니다.\"\r\n        });\r\n    }\r\n}\r\n\r\napp.listen(PORT_NUMBER, () => {\r\n    console.log(\"Express app is running on port \" + PORT_NUMBER);\r\n})"],"mappings":"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"}