{"version":3,"file":"server.js","names":["app","express","require","CheckUser","AddUser","GetData","UpdateData","PORT_NUMBER","use","urlencoded","extended","post","req","res","CreateUser","body","userKey","gameData","json","JSON","parse","dataJson","result","tryCount","crypto","randomBytes","toString","setHeader","console","log","message","listen"],"sources":["../src/server.js"],"sourcesContent":["import express from \"express\";\r\nimport crypto from \"crypto\";\r\nconst app = express();\r\n\r\nconst { CheckUser, AddUser, GetData, UpdateData } = require(\"./dynamodb\");\r\n\r\nconst PORT_NUMBER = 2022;\r\n\r\napp.use(express.urlencoded({ extended: true }));\r\napp.post('/create-user', async (req, res) => {\r\n    CreateUser(res);\r\n});\r\napp.post('/get-data', async (req, res) => {\r\n    const gameData = await GetData(req.body.userKey);\r\n    // console.log(gameData);\r\n    res.json(gameData);\r\n});\r\napp.post('/sync-data', async (req, res) => {\r\n    const gameData = {\r\n        ...JSON.parse(req.body.dataJson)\r\n    };\r\n    if(await UpdateData(gameData)) {\r\n        res.json({\r\n            result : 200\r\n        });\r\n    } else {\r\n        res.json({\r\n            result : 500\r\n        });\r\n    }\r\n});\r\n\r\nasync function CreateUser(res) {\r\n    let userKey;\r\n    let tryCount = 0;\r\n    do {\r\n        tryCount ++;\r\n        userKey = crypto.randomBytes(64).toString('base64');\r\n    } while(!await CheckUser(userKey) || tryCount >= 10);\r\n    res.setHeader(\"Content-Type\", \"application/json\");\r\n    if(await AddUser(userKey)) {\r\n        res.json({\r\n            result : 200,\r\n            userKey : userKey\r\n        });\r\n    } else {\r\n        console.log(\"Faild to put new user key. So return error-message to client.\");\r\n        res.json({\r\n            result : 500,\r\n            message : \"서버에서 예외가 발생하였습니다.\\n서버 담당자에게 문의해주시길 바랍니다.\"\r\n        });\r\n    }\r\n}\r\n\r\napp.listen(PORT_NUMBER, () => {\r\n    console.log(\"Express app is running on port \" + PORT_NUMBER);\r\n})"],"mappings":"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"}